{% include "includes/header.html" %}
{% load static %}

<div class="container mt-5">

    <h2 class="text-center mb-4">Prédiction : Personne Fit ou Non</h2>

    <div class="card shadow-sm p-4">

        <h5 class="mb-3 text-center">Tester le Modèle Fitness</h5>

        <!-- CHOIX DE LA MÉTHODE -->
        <ul class="nav nav-tabs mb-4" id="testMode" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#formulaire"
                    type="button" role="tab">Entrer les données</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#upload"
                    type="button" role="tab">Uploader un CSV/Excel</button>
            </li>
        </ul>

        <div class="tab-content" id="testModeContent">

            <!-- FORMULAIRE MANUEL -->
            <div class="tab-pane fade show active" id="formulaire" role="tabpanel">

                <form method="post" action="{% url 'xgb_prediction' %}">
                    {% csrf_token %}

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Âge</label>
                            <input type="number" name="age" class="form-control" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Sexe</label>
                            <select class="form-select" name="gender" required>
                                <option value="" disabled selected>Choisir</option>
                                <option value="F">Femme</option>
                                <option value="M">Homme</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Taille (cm)</label>
                            <input type="number" name="height_cm" class="form-control" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Poids (kg)</label>
                            <input type="number" name="weight_kg" class="form-control" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Fréquence cardiaque</label>
                        <input type="number" step="0.1" name="heart_rate" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Pression artérielle</label>
                        <input type="number" step="0.1" name="blood_pressure" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Heures de sommeil</label>
                        <input type="number" step="0.1" name="sleep_hours" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Qualité nutrition (0–5)</label>
                        <input type="number" step="0.1" name="nutrition_quality" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Indice d’activité</label>
                        <input type="number" step="0.1" name="activity_index" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Fume ?</label>
                        <select class="form-select" name="smokes" required>
                            <option value="" disabled selected>Choisir</option>
                            <option value="yes">Oui</option>
                            <option value="no">Non</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        Prédire si la personne est Fit
                    </button>
                </form>
            </div>

            <!-- UPLOAD CSV -->
            <div class="tab-pane fade" id="upload" role="tabpanel">

                <form method="post" action="{% url 'xgb_prediction_csv' %}" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label">Uploader un fichier CSV ou Excel</label>
                        <input type="file" name="fichier" accept=".csv,.xlsx" class="form-control" required>
                    </div>

                    <button type="submit" class="btn btn-success w-100">
                        Prédire plusieurs lignes (Batch)
                    </button>
                </form>

                <!-- CSV exemple -->
                <div class="mt-3 text-center">
                    <a href="{% static 'tests/dataset_fitness_test.csv' %}" class="btn btn-outline-secondary">
                        Télécharger le CSV de test
                    </a>
                </div>

            </div>
        </div>

        {% if prediction %}
        <div class="alert alert-info mt-4 text-center">
            <h4>Résultat : <strong>{{ prediction }}</strong></h4>
        </div>
        {% endif %}

        {% if predictions_batch %}
        <div class="table-responsive mt-4">
            <h5 class="text-center mb-3">Résultats des prédictions :</h5>
            <table class="table table-bordered table-striped text-center">
                <thead class="table-dark">
                    <tr>
                        {% for col in predictions_batch.0.keys %}
                        <th>{{ col|capfirst }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in predictions_batch %}
                    <tr>
                        {% for value in row.values %}
                        <td>{{ value }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Bouton télécharger -->
            <div class="text-center mb-3">
                <form method="get" action="{% url 'xgb_download_csv' %}">
                    <button type="submit" class="btn btn-success btn-lg">
                        Télécharger CSV avec Résultats
                    </button>
                </form>
            </div>
        </div>
        {% endif %}

    </div>
</div>

{% include "includes/footer.html" %}

